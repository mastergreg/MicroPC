DEFINE_ASCII MACRO
    LOCAL GRAMMA,PSIFIO,SYNEXEIA,GRAMMA2,PSIFIO2,SYNEXEIA2
    LOCAL SKIP_ASCII 
    JMP SKIP_ASCII
    
    ASCII PROC NEAR   
    PUSH BX                                                   
    MOV AH,AL       ; SAVE TON AL
    AND AL,0FH      ; APOMONWSH TWN 4 LSB BITS
    CMP AL,09H 
    JG  GRAMMA      ; AN EINAI GRAMMA
    JMP PSIFIO      ; AN EINAI ARITHMOS  
    
GRAMMA:           
    ADD AL,37H      ; ASCII GIA KEFALAIA
    JMP SYNEXEIA
    
PSIFIO:
    ADD AL,30H
    
SYNEXEIA:     
    MOV BL,AL       ; SAVE TON AL
    AND AH,0F0H     ; APOMONWSH TWN 4 MSB BITS
    SHR AH,4        ; OLIS8HSH 4 8ESEIS DEXIA GIA NA PARW TA 4 MSB BITS
    CMP AH,09H
    JG GRAMMA2
    JMP PSIFIO2
    
GRAMMA2:            ; AH ->ASCII 4 MSB BITS
    ADD AH,37H
    JMP SYNEXEIA2
    
PSIFIO2:
    ADD AH,30H
                 
SYNEXEIA2:
    MOV AL,BL       ; AL ->ASCII TWN 4 LSB BITS
    POP BX     
RET
ASCII ENDP     
    
SKIP_ASCII:
DEFINE_ASCII ENDM

DEFINE_NUMBER MACRO
    LOCAL CONT,CONT1
    LOCAL SKIP_NUMBER
    JMP SKIP_NUMBER  
    
    NUMBER PROC NEAR 
    PUSH BX
    PUSH CX
    PUSH DX
    SUB AL,30H      ; AN O AL EINAI ASCII ARITHMOU
    CMP AL,09H
    JLE CONT
    SUB AL,07H      ; ASCII KEFALAIOU
    CMP AL,09H
    JLE CONT
    SUB AL,20H      ; ASCII MIKROU GRAMMATOS
    
CONT:
    SUB AH,30H      ; ANTISTOIXA GIA TON AH
    CMP AH,09H
    JLE CONT1
    SUB AH,07H
    CMP AH,09H
    JLE CONT1
    SUB AH,20H
    
CONT1:   
    
    SHL AH,4        ; POLLAPLASIASMOS TWN 4 MSB ME 16 
    ADD AL,AH       ; AL ->PROS8ESI TWN DYO ARI8MWN
    MOV AH,0
    POP DX
    POP CX
    POP BX       
RET          
NUMBER ENDP
    
SKIP_NUMBER:
DEFINE_NUMBER ENDM    

DEFINE_PRINT_HEX MACRO  
; TYPWNEI TON ANTISTOIXO HEX ARI8MO POU VRISKETAI STON AH
    LOCAL ADDR,ADR2
    LOCAL SKIP_PRINT_HEX
    JMP SKIP_PRINT_HEX 
    
    PRINT_HEX PROC NEAR
    PUSH BX
    PUSH CX
    PUSH DX
    CMP AH,9        ; AN O ARI8MOS EINAI METAKSY 0 K 9 PROS8ETW 30H
    JG ADDR
    ADD AH,30h
    JMP ADR2

ADDR:
    ADD AH, 37h     ; DIAFORETIKA PROS8ETW 37H ('A' = 41H)
ADR2:
    PRINT AH
    POP DX
    POP CX
    POP BX
    RET 
PRINT_HEX ENDP
    
SKIP_PRINT_HEX:
DEFINE_PRINT_HEX ENDM  

DEFINE_PRINT_DEC MACRO
    LOCAL ADDR1,ADDR2
    LOCAL SKIP_PRINT_DEC
    JMP SKIP_PRINT_DEC
    
PRINT_DEC PROC NEAR  
; TYPWNEI TON ANTISTOIXO DEKADIKO POU VRISKETAI STON AX
    PUSH DX
    PUSH CX
    PUSH BX
    MOV CX,0 
    
ADDR1:
    MOV DX,0
    MOV BX,10
    DIV BX
    PUSH DX
    INC CX
    CMP AX,0
    JNZ ADDR1
    
ADDR2:
    POP DX
    PRINT_NUM DX
    LOOP ADDR2
    POP BX
    POP CX
    POP DX 
    RET
PRINT_DEC ENDP 
SKIP_PRINT_DEC:
DEFINE_PRINT_DEC ENDM 


DEFINE_READ_HEX MACRO 
; DIAVAZEI TOUS DYO ARI8MOUS KAI THN PRAXH(+ H -)
    LOCAL IGNORE,CONTIN,PROSTHE,CONT2,PSIFIO_1,PSIFIA_2,PSIFIA_3,PSIFIA_4,SYNEX,IGNORE1
    LOCAL CONT3,CONT4,PSIFIO1_2,PSIFIA2_2,PSIFIA3_2,PSIFIA4_2,TELOS
    LOCAL SKIP_READ_HEX
    JMP SKIP_READ_HEX

READ_HEX PROC NEAR
    MOV BX,0     
    MOV CX,0
    MOV DX,0
     
IGNORE:          
    READ            ; DIAVAZEI MEXRI 4 HEX PSIFIA, STAMATAEI OTAN DIAVASEI + H -
    CMP AL,2BH      ; ELEGXOS GIA +
    JE PROSTHE
    CMP AL,2DH      ; ELEGXOS GIA '-'                 
    JE CONT2        ; 'q'/'Q' TERMATISMOS                               
    CMP AL,'Q'
    JE QUIT 
    CMP AL,'q'
    JE QUIT
    CMP BX,4        ; AGNOEI PERA TWN 4 PSIFIWN
    JE IGNORE 
    CMP AL,30H
    JL IGNORE       ; AGNOEI PERA TWN HEX PSIFIWN
    CMP AL,39H
    JLE CONTIN
    CMP AL,'A'
    JL IGNORE
    CMP AL,'F'
    JLE CONTIN
    CMP AL,'a'
    JL IGNORE
    CMP AL,'f'
    JLE CONTIN
    JMP IGNORE
    
CONTIN:      
    MOV AH,0
    PUSH AX
    INC BL          ; METRHTHS PSIFIWN
    JMP IGNORE

PROSTHE:
    MOV PROSTH,1    ; SAN FLAG GIA PROS8ESH
CONT2:   
    CMP BX,00       ; FTIAXNEI TON ARI8MO ANALOGA ME TON ARI8MO TWN SPIFIWN
    JZ QUIT
    CMP BL,1
    JE PSIFIO_1
    CMP BL,2
    JE PSIFIA_2
    CMP BL,3
    JE PSIFIA_3
    CMP BL,4
    JE PSIFIA_4
    
PSIFIO_1:
    POP AX
    MOV AH,30H      ; AH => '0'
    CALL NUMBER   
    JMP SYNEX       ; 1 PSIFIO ->AX
    
PSIFIA_2:
    POP AX
    MOV CL,AL       ; ENDIAMESOS KATAXWRHTHS GIA TO LSB BIT(OPWS DIVAZOYME AP' TH STOIVA)
    POP AX          ; MSB BIT
    MOV AH,AL
    MOV AL,CL   
    CALL NUMBER
    JMP SYNEX       ; 2 PSIFIA -> AX

PSIFIA_3:
    POP AX          ; 3o-2o (2 LSB BITS)
    MOV BL,AL
    POP AX
    MOV AH,AL
    MOV AL,BL
    CALL NUMBER      
    MOV DX,AX
    
    POP AX
    MOV AH,30H      ; 1o PSIFIO   
    CALL NUMBER
    MOV AH,AL       ; POL/ZOYME EPI 16^2= 2^8 TO MSB BIT <=> PHGAINEI STON MSB KATAXWRHTH
    MOV AL,DL     
    JMP SYNEX       ; 3 PSIFIA ->AX
    
PSIFIA_4:    
    POP AX
    MOV CL,AL
    POP AX
    MOV AH,AL       ; 2o LSB BIT P ANASYROYME AP' TH STOIVA        
    MOV AL,CL     
    CALL NUMBER
    MOV DX,AX       ; 4o-3o PSIFIO STON DX
    
    POP AX
    MOV CL,AL
    POP AX          ; 2o-1o BIT
    MOV AH,AL
    MOV AL,CL
    CALL NUMBER
    MOV AH,AL
    MOV AL,DL       ; SAN POL/SMOS EPI 256 TA 2 MSB PSIFIA 
                    ; 4 PSIFIA ->AX  
    
SYNEX:              ; 2os ARI8MOS      
    PUSH AX         ; APO8IKEYSH 1ou ARI8MOY STH STOIVA
    
    MOV BX,0        ; MHDENISMOS METRHTH PSIFIWN
IGNORE1:
    READ 
    CMP AL,0DH      ; ELEGXOS GIA <ENTER>
    JE CONT4
    CMP AL,'Q'
    JE QUIT 
    CMP AL,'q'
    JE QUIT
    CMP BX,4        ; AGNOEI PERA TWN 4 PSIFIWN
    JE IGNORE1      ; KAI TWN HEX PSIFIWN
    CMP AL,30H
    JL IGNORE1
    CMP AL,39H
    JLE CONT3
    CMP AL,'A'
    JL IGNORE1
    CMP AL,'F'
    JLE CONT3
    CMP AL,'a'
    JL IGNORE1
    CMP AL,'f'
    JLE CONT3
    JMP IGNORE1 

CONT3:
    PUSH AX
    MOV AH,0
    INC BL
    JMP IGNORE1    
    
CONT4:              
; IDIA DIADIKASIA GIA NA "FTIAXOYME" TO 2o ARI8MO
    CMP BL,00H
    JE QUIT
    CMP BL,1
    JE PSIFIO1_2
    CMP BL,2
    JE PSIFIA2_2
    CMP BL,3
    JE PSIFIA3_2
    CMP BL,4
    JGE PSIFIA4_2

    
PSIFIO1_2:
    POP AX
    MOV AH,30H
    CALL NUMBER
    JMP TELOS       ; 1 PSIFIO ->AX
    
PSIFIA2_2:
    POP AX
    MOV CL,AL       ; ENDIAMESOS KATAXWRHTHS GIA TO LSB PSIFIO
    POP AX
    MOV AH,AL
    MOV AL,CL    
    CALL NUMBER
    JMP TELOS       ; 2 PSIFIA ->AX

PSIFIA3_2:
    POP AX          ; 3o-2o
    MOV BL,AL
    POP AX
    MOV AH,AL
    MOV AL,BL
    CALL NUMBER      
    MOV DX,AX
    
    POP AX
    MOV AH,30H      ; 1o PSIFIO   
    CALL NUMBER
    MOV AH,AL
    MOV AL,DL       ; POL/ZOYME EPI 256 TO 1o PSIFIO
    JMP TELOS       ; 3 PSIFIA ->AX
    
PSIFIA4_2:    
    POP AX
    MOV CL,AL
    POP AX
    MOV AH,AL        
    MOV AL,CL
    CALL NUMBER
    MOV DX,AX       ; 4o-3o PSIFIO STON DX
    
    POP AX
    MOV CL,AL
    POP AX
    MOV AH,AL       ; 1o-2o
    MOV AL,CL
    CALL NUMBER
    MOV AH,AL
    MOV AL,DL       ; SAN POL/SMOS EPI 256 TA 2 MSB PSIFIA 
                    ; 4 PSIFIA ->AX  
                
TELOS: 
    MOV DX,AX       ; 2os ARI8MOS ->DX
    POP AX          ; 1os ARI8MOS ->AX
RET
READ_HEX ENDP
SKIP_READ_HEX:
DEFINE_READ_HEX ENDM        
